<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Assistant Control</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #121212;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
        }

        #status-text {
            color: white;
            font-family: sans-serif;
            font-size: 1.5rem;
            text-align: center;
            pointer-events: none;
            position: absolute;
            top: 20px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }

        #video-container {
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #video-feed {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>

<body onclick="togglePipeline()">
    <div id="status-text">í™”ë©´ ì•„ë¬´ ë°ë‚˜ í´ë¦­í•˜ë©´ ì‹œì‘í•©ë‹ˆë‹¤.</div>
    <div id="video-container">
        <img id="video-feed" src="">
    </div>

    <!-- ë§ˆì´í¬ ì—†ì„ ë•Œë¥¼ ìœ„í•œ ê°€ìƒ ìŒì„± ëª…ë ¹ ë²„íŠ¼ -->
    <div id="debug-panel">
        <button onclick="sendSimulatedCommand(event, 'ë³¼ë¥¨ ì˜¬ë ¤')">ğŸ”Š ë³¼ë¥¨ +</button>
        <button onclick="sendSimulatedCommand(event, 'ë³¼ë¥¨ ë‚´ë ¤')">ğŸ”‰ ë³¼ë¥¨ -</button>
        <button onclick="sendSimulatedCommand(event, 'ì¡°ìš©íˆ í•´')">ğŸ”‡ ì¡°ìš©íˆ í•´</button>
        <button onclick="sendSimulatedCommand(event, 'ë§í•´ì¤˜')">ğŸ“¢ ë§í•´ì¤˜</button>
        <button onclick="sendSimulatedCommand(event, 'ì¢…ë£Œí•´')" style="background: #D32F2F;">ğŸ›‘ ì¢…ë£Œí•´</button>
    </div>

    <style>
        #debug-panel {
            position: absolute;
            bottom: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
        }

        #debug-panel button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #333;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        #debug-panel button:hover {
            background: #555;
        }
    </style>

    <script>
        let isRunning = false;
        const statusText = document.getElementById('status-text');
        const videoContainer = document.getElementById('video-container');
        const videoFeed = document.getElementById('video-feed');

        async function togglePipeline() {
            const endpoint = isRunning ? '/stop' : '/start';
            const method = 'POST';

            try {
                const response = await fetch(endpoint, { method });
                const data = await response.json();

                if (data.status === 'started' || data.status === 'already_running') {
                    isRunning = true;
                    statusText.innerHTML = "ì‘ë™ ì¤‘... ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì •ì§€í•©ë‹ˆë‹¤.";
                    statusText.style.color = "#4CAF50";

                    // ë¹„ë””ì˜¤ í”¼ë“œ í™œì„±í™” (ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€)
                    videoFeed.src = "/video_feed?t=" + new Date().getTime();
                    videoContainer.style.display = "flex";
                } else {
                    isRunning = false;
                    statusText.innerHTML = "ì •ì§€ë¨. ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì‹œì‘í•©ë‹ˆë‹¤.";
                    statusText.style.color = "#FF5252";

                    // ë¹„ë””ì˜¤ í”¼ë“œ ë¹„í™œì„±í™”
                    videoFeed.src = "";
                    videoContainer.style.display = "none";
                }
            } catch (error) {
                console.error("Error toggling pipeline:", error);
                alert("ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        async function sendSimulatedCommand(event, commandText) {
            // ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€ (bodyì˜ togglePipelineì´ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ í•¨)
            if (event) event.stopPropagation();

            try {
                await fetch('/command', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: commandText })
                });
                console.log("Simulated command sent:", commandText);
            } catch (error) {
                console.error("Error sending command:", error);
            }
        }
    </script>
</body>

</html>